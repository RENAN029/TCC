<div class="student-management-container">
  <div class="header-section">
    <button routerLink="/admin-dashboard" class="back-button">‚Üê Voltar</button>
    <h1>Gerenciar Estudantes</h1>
  </div>

  <div class="controls-section">
    <div class="search-box">
      <input 
        type="text" 
        [(ngModel)]="searchTerm" 
        (input)="onSearchChange()"
        placeholder="Buscar por nome, email ou matr√≠cula..."
        class="search-input">
      <span class="search-icon">üîç</span>
    </div>

    <div class="filters">
      <select 
        [(ngModel)]="filterStatus" 
        (change)="onFilterChange(filterStatus)"
        class="filter-select">
        <option value="all">Todos os status</option>
        <option value="active">Carteirinha Ativa</option>
        <option value="expired">Carteirinha Expirada</option>
        <option value="pending">Solicita√ß√£o Pendente</option>
        <option value="rejected">Solicita√ß√£o Rejeitada</option>
        <option value="none">Sem Carteirinha</option>
      </select>
    </div>
  </div>

  <div class="students-count">
    {{ filteredStudents.length }} estudante(s) encontrado(s)
  </div>

  <div class="students-list">
    <div *ngFor="let student of filteredStudents" class="student-card">
      <div class="student-main-info">
        <div class="student-avatar">
          {{ student.name ? student.name.charAt(0).toUpperCase() : '?' }}
        </div>
        <div class="student-details">
          <h3>{{ student.name || 'Nome n√£o informado' }}</h3>
          <p class="student-email">{{ student.email }}</p>
          <p class="student-registration">Matr√≠cula: {{ student.registrationNumber }}</p>
        </div>
      </div>

      <div class="student-status">
        <span [class]="'status-badge ' + getActualStudentStatus(student)">
          {{ getStatusText(getActualStudentStatus(student)) }}
        </span>
        <p *ngIf="getActualStudentStatus(student) === 'expired'" class="expired-warning">
          ‚ö†Ô∏è Expirada
        </p>
        <p *ngIf="isCardExpiredForStudent(student) && getActualStudentStatus(student) === 'active'" class="expired-warning">
          ‚ö†Ô∏è Expirada (atualize a p√°gina)
        </p>
      </div>

      <div class="student-actions">
        <button 
          (click)="viewStudentDetails(student)"
          class="btn btn-info">
          üëÅÔ∏è Detalhes
        </button>
        <button 
          (click)="removeStudent(student)"
          class="btn btn-danger">
          üóëÔ∏è Remover
        </button>
      </div>
    </div>

    <div *ngIf="filteredStudents.length === 0" class="no-students">
      <div class="no-students-icon">üë•</div>
      <h3>Nenhum estudante encontrado</h3>
      <p>Tente ajustar os filtros ou termos de busca.</p>
    </div>
  </div>

  <!-- Modal de Detalhes do Estudante -->
  <div *ngIf="selectedStudent" class="modal-overlay" (click)="closeDetails()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Detalhes do Estudante</h2>
        <button (click)="closeDetails()" class="close-button">√ó</button>
      </div>

      <div class="modal-body">
        <!-- Perfil do Estudante -->
        <div class="student-profile">
          <div class="profile-avatar">
            {{ selectedStudent.name ? selectedStudent.name.charAt(0).toUpperCase() : '?' }}
          </div>
          <div class="profile-info">
            <h3>{{ selectedStudent.name || 'Nome n√£o informado' }}</h3>
            <p>{{ selectedStudent.email }}</p>
          </div>
        </div>

        <!-- Informa√ß√µes B√°sicas -->
        <div class="detail-section">
          <h3>Informa√ß√µes B√°sicas</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <label>Email:</label>
              <span>{{ selectedStudent.email }}</span>
            </div>
            <div class="detail-item">
              <label>Matr√≠cula:</label>
              <span>{{ selectedStudent.registrationNumber }}</span>
            </div>
            <div class="detail-item">
              <label>Status:</label>
              <span [class]="'status-badge ' + getActualStudentStatus(selectedStudent)">
                {{ getStatusText(getActualStudentStatus(selectedStudent)) }}
              </span>
            </div>
            <div class="detail-item">
              <label>Cadastrado em:</label>
              <span>{{ selectedStudent.registeredAt | date:'dd/MM/yyyy HH:mm' }}</span>
            </div>
            <div class="detail-item">
              <label>√öltimo login:</label>
              <span>{{ selectedStudent.lastLogin ? (selectedStudent.lastLogin | date:'dd/MM/yyyy HH:mm') : 'Nunca logou' }}</span>
            </div>
          </div>
        </div>

        <!-- Informa√ß√µes da Carteirinha -->
        <div class="detail-section" *ngIf="getStudentCard(selectedStudent.email)">
          <h3>Informa√ß√µes da Carteirinha</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <label>ID da Carteirinha:</label>
              <span>{{ getStudentCard(selectedStudent.email)?.id }}</span>
            </div>
            <div class="detail-item">
              <label>Data de Emiss√£o:</label>
              <span>{{ getStudentCard(selectedStudent.email)?.issueDate | date:'dd/MM/yyyy' }}</span>
            </div>
            <div class="detail-item">
              <label>Data de Expira√ß√£o:</label>
              <span>{{ getStudentCard(selectedStudent.email)?.expirationDate | date:'dd/MM/yyyy' }}</span>
            </div>
            <div class="detail-item">
              <label>Curso:</label>
              <span>{{ getStudentCard(selectedStudent.email)?.course || 'N√£o informado' }}</span>
            </div>
            <div class="detail-item" *ngIf="getStudentCard(selectedStudent.email)?.rejectionReason">
              <label>Motivo da Recusa:</label>
              <span class="rejection-reason-text">{{ getStudentCard(selectedStudent.email)?.rejectionReason }}</span>
            </div>
          </div>
        </div>

        <!-- Informa√ß√µes Pessoais -->
        <div class="detail-section" *ngIf="selectedStudent.personalInfo">
          <h3>Informa√ß√µes Pessoais</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <label>Nome Completo:</label>
              <span>{{ selectedStudent.personalInfo.name }}</span>
            </div>
            <div class="detail-item">
              <label>CPF:</label>
              <span>{{ selectedStudent.personalInfo.cpf }}</span>
            </div>
            <div class="detail-item">
              <label>Data de Nascimento:</label>
              <span>{{ selectedStudent.personalInfo.birthDate | date:'dd/MM/yyyy' }}</span>
            </div>
            <div class="detail-item">
              <label>G√™nero:</label>
              <span>{{ selectedStudent.personalInfo.gender }}</span>
            </div>
            <div class="detail-item">
              <label>Escolaridade:</label>
              <span>{{ getEducationLevelText(selectedStudent.personalInfo.educationLevel) }}</span>
            </div>
          </div>
        </div>

        <!-- Endere√ßo -->
        <div class="detail-section" *ngIf="selectedStudent.address">
          <h3>Endere√ßo</h3>
          <div class="address-info">
            <p><strong>Logradouro:</strong> {{ selectedStudent.address.street }}, {{ selectedStudent.address.number }}</p>
            <p><strong>Bairro:</strong> {{ selectedStudent.address.neighborhood }}</p>
            <p><strong>Cidade/Estado:</strong> {{ selectedStudent.address.city }} - {{ selectedStudent.address.state }}</p>
          </div>
        </div>

        <!-- Aviso de Carteirinha Expirada -->
        <div *ngIf="isCardExpiredForStudent(selectedStudent) && getActualStudentStatus(selectedStudent) === 'active'" class="warning-section">
          <div class="warning-icon">‚ö†Ô∏è</div>
          <div class="warning-content">
            <h4>Carteirinha Expirada</h4>
            <p>Esta carteirinha est√° com status "Ativa" mas a data de expira√ß√£o j√° passou. O status ser√° atualizado automaticamente.</p>
          </div>
        </div>

        <!-- Aviso de Sem Informa√ß√µes -->
        <div *ngIf="!selectedStudent.personalInfo" class="info-section">
          <div class="info-icon">‚ÑπÔ∏è</div>
          <div class="info-content">
            <h4>Informa√ß√µes Incompletas</h4>
            <p>Este estudante ainda n√£o completou o cadastro de informa√ß√µes pessoais.</p>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button 
          (click)="removeStudent(selectedStudent)"
          class="btn btn-danger">
          üóëÔ∏è Remover Estudante
        </button>
        <button 
          (click)="closeDetails()"
          class="btn btn-secondary">
          Fechar
        </button>
      </div>
    </div>
  </div>
</div>